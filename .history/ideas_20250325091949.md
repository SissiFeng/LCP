# LCP (Laboratory Context Protocol)

LCP (Laboratory Context Protocol) is a technical protocol our team is developing to address the **isolation between laboratory instruments and data processing systems** in experimental automation.  

In traditional lab environments, researchers often manually operate instruments and rely on **standalone control software** for data acquisition and processing. This approach is not only inefficient but also prone to **data transfer errors** and **repetitive experiments**. The goal of LCP is to **define a universal communication protocol** that enables laboratory instruments to interact seamlessly with data analysis systems, multi-objective optimization (MO) algorithms, databases, and remote computing environments, thereby enhancing experimental automation and data management efficiency.  

## **Key Features of LCP:**  
- **Instrument Connectivity** â€“ Standardized integration of various laboratory devices (e.g., sensors, robots, analytical instruments).  
- **Data Stream Management** â€“ Supports real-time data transmission in a standardized format to databases or processing pipelines.  
- **Multi-Objective Optimization Integration** â€“ Seamlessly connects with MO algorithms to enable intelligent parameter adjustments.  
- **Extensibility** â€“ Designed as an **open standard**, allowing developers to expand support for new instruments, optimization methods, and analytical tools.  

LCP is currently being integrated with the **Canvas system** (built on React Flow), aiming to create an **end-to-end experimental automation solution** that allows researchers to **design experiments like writing code** while optimizing workflows using intelligent algorithms.  

Although LCP originated from our efforts in **experimental automation**, it is designed to be **a general-purpose protocol**, applicable to **various smart laboratories and automated research platforms**. Developers can extend LCP to support new experimental environments and applications based on their research needs.  

ğŸ“‚ lcp
 â”£ ğŸ“‚ core                  # æ ¸å¿ƒæœåŠ¡
 â”£ ğŸ“‚ adapters              # åè®®é€‚é…å™¨
 â”‚  â”£ ğŸ“„ mqtt-adapter.js    # MQTTåè®®é€‚é…
 â”‚  â”£ ğŸ“„ websocket-adapter.js # WebSocketåè®®é€‚é…
 â”‚  â”— ğŸ“„ rest-adapter.js    # RESTåè®®é€‚é…
 â”£ ğŸ“‚ models                # æ•°æ®æ¨¡å‹
 â”‚  â”£ ğŸ“„ device.js          # è®¾å¤‡æ¨¡å‹
 â”‚  â”— ğŸ“„ data-point.js      # æ•°æ®ç‚¹æ¨¡å‹
 â”£ ğŸ“‚ validators            # æ•°æ®éªŒè¯
 â”£ ğŸ“‚ api                   # APIæœåŠ¡
 â”£ ğŸ“‚ auth                  # æˆæƒæœåŠ¡
 â”£ ğŸ“‚ errors                # é”™è¯¯å¤„ç†
 â”— ğŸ“„ index.js              # ä¸»å…¥å£


æ–°æ¨¡å¼ï¼ˆJSON-RPC/stdinï¼‰ï¼š

çŠ¶æ€éš”ç¦»æ›´å¥½ï¼šæ¯ä¸ª LCP Server è¿è¡Œç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä¸è®¾å¤‡çš„ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œä¸ä¼šå› ç½‘ç»œæ³¢åŠ¨å½±å“ Canvas é€»è¾‘ã€‚
æ›´é€‚åˆå¤šå·¥ä½œæµç®¡ç†ï¼šæ ‡å‡†åŒ–çš„ JSON-RPC æ ¼å¼æ”¯æŒæ›´ç»†ç²’åº¦çš„è¯·æ±‚æ ‡è¯†ï¼Œå¯ç»“åˆ workflow_id è¿›è¡Œè¿½è¸ªã€‚
å…¼å®¹æ€§é«˜ï¼šèƒ½å¤Ÿé€æ­¥è¿ç§»ï¼ŒCanvas ç°æœ‰ HTTP/MQTT ç»“æ„ä»ç„¶èƒ½ç»§ç»­å·¥ä½œã€‚
é™ä½å¤–éƒ¨ API ä¾èµ–ï¼šå‡å°‘ HTTP å¼€é”€ï¼Œç›´æ¥ä¸ LCP è¿›ç¨‹é€šä¿¡ï¼Œé€‚ç”¨äºæœ¬åœ°ä»ªå™¨æˆ–è¿œç¨‹é›†ç¾¤ã€‚

æ˜ç™½äº†ï¼Œä»æ‚¨çš„å›¾ç‰‡å’Œæè¿°æ¥çœ‹ï¼ŒLCPçš„æ ¸å¿ƒä»·å€¼åœ¨äºæ ‡å‡†åŒ–å’ŒæŠ½è±¡ã€‚è®©æˆ‘æ¢³ç†ä¸€ä¸‹æ ‡å‡†åŒ–çš„æ€è·¯ï¼š

### ä¸€ã€æ ‡å‡†æ¥å£åè®®å±‚ï¼ˆProtocol Layerï¼‰

1. **ç»Ÿä¸€æ§åˆ¶æŒ‡ä»¤é›†**
   ```javascript
   // æ‰€æœ‰è®¾å¤‡éƒ½åº”è¯¥æ”¯æŒçš„åŸºç¡€æŒ‡ä»¤
   const BASE_COMMANDS = {
     START: 'start',           // å¯åŠ¨è®¾å¤‡/å®éªŒ
     STOP: 'stop',            // åœæ­¢è®¾å¤‡/å®éªŒ
     CONFIGURE: 'configure',   // é…ç½®è®¾å¤‡å‚æ•°
     STATUS: 'status',        // è·å–è®¾å¤‡çŠ¶æ€
     RESET: 'reset',          // é‡ç½®è®¾å¤‡
     CALIBRATE: 'calibrate'   // æ ¡å‡†è®¾å¤‡
   }
   ```

2. **æ ‡å‡†çŠ¶æ€å®šä¹‰**
   ```javascript
   const DEVICE_STATES = {
     IDLE: 'idle',           // ç©ºé—²çŠ¶æ€
     RUNNING: 'running',     // è¿è¡Œä¸­
     ERROR: 'error',         // é”™è¯¯çŠ¶æ€
     MAINTENANCE: 'maintenance', // ç»´æŠ¤çŠ¶æ€
     CALIBRATING: 'calibrating' // æ ¡å‡†ä¸­
   }
   ```

### äºŒã€è®¾å¤‡æ§åˆ¶æŠ½è±¡å±‚ï¼ˆAbstraction Layerï¼‰

1. **è®¾å¤‡ç±»å‹åˆ†ç±»**
   ```javascript
   const DEVICE_CATEGORIES = {
     LIQUID_HANDLING: 'liquid_handling',   // æ¶²ä½“å¤„ç†è®¾å¤‡
     THERMAL_CONTROL: 'thermal_control',   // æ¸©æ§è®¾å¤‡
     MEASUREMENT: 'measurement',           // æµ‹é‡è®¾å¤‡
     SEPARATION: 'separation',             // åˆ†ç¦»è®¾å¤‡
     IMAGING: 'imaging'                    // æˆåƒè®¾å¤‡
   }
   ```

2. **æ ‡å‡†åŒ–æ¥å…¥æ­¥éª¤**ï¼š

```javascript
// 1. è®¾å¤‡æè¿°æ–‡ä»¶ (device-descriptor.json)
{
  "device_type": "thermal_cycler",
  "category": "THERMAL_CONTROL",
  "capabilities": [
    "temperature_control",
    "program_execution",
    "data_logging"
  ],
  "parameters": {
    "temperature": {
      "type": "number",
      "range": [-20, 100],
      "unit": "celsius"
    },
    "duration": {
      "type": "number",
      "unit": "seconds"
    }
  }
}

// 2. è®¾å¤‡é€‚é…å™¨æ¨¡æ¿
class DeviceAdapter {
  async initialize() {}
  async start(params) {}
  async stop() {}
  async getStatus() {}
  async configure(settings) {}
  async getData() {}
}
```

### ä¸‰ã€æ ‡å‡†åŒ–æµç¨‹

1. **è®¾å¤‡æ¥å…¥æµç¨‹**
   - å®šä¹‰è®¾å¤‡æè¿°æ–‡ä»¶
   - å®ç°æ ‡å‡†æ¥å£é€‚é…
   - é…ç½®é€šä¿¡åè®®
   - éªŒè¯å…¼å®¹æ€§

2. **æ•°æ®æ ‡å‡†åŒ–**
   ```javascript
   // æ ‡å‡†æ•°æ®æ ¼å¼
   {
     "timestamp": "ISO8601",
     "device_id": "unique_id",
     "type": "measurement|status|error",
     "data": {
       "value": number,
       "unit": "string",
       "metadata": {}
     }
   }
   ```

### å››ã€å®æ–½å»ºè®®

1. **æ¨¡å—åŒ–æ¥å…¥åŒ…**
   - æä¾›æ ‡å‡†SDK
   - è®¾å¤‡é€‚é…å™¨æ¨¡æ¿
   - éªŒè¯å·¥å…·é›†
   - ç¤ºä¾‹å®ç°

2. **æ–‡æ¡£æ ‡å‡†åŒ–**
   ```markdown
   # è®¾å¤‡æ¥å…¥æ–‡æ¡£æ¨¡æ¿
   1. è®¾å¤‡åŸºæœ¬ä¿¡æ¯
   2. æ”¯æŒçš„æŒ‡ä»¤é›†
   3. å‚æ•°è§„èŒƒ
   4. æ•°æ®æ ¼å¼
   5. é”™è¯¯å¤„ç†
   6. ç¤ºä¾‹ä»£ç 
   ```

3. **éªŒè¯æ¸…å•**
   - åŸºç¡€æŒ‡ä»¤é›†æ”¯æŒ
   - æ•°æ®æ ¼å¼ç¬¦åˆæ€§
   - é”™è¯¯å¤„ç†æœºåˆ¶
   - æ€§èƒ½æŒ‡æ ‡
   - å®‰å…¨è¦æ±‚

### äº”ã€æ‰©å±•æ€§è€ƒè™‘

1. **è‡ªå®šä¹‰èƒ½åŠ›**
   ```javascript
   // è®¾å¤‡ç‰¹å®šåŠŸèƒ½æ‰©å±•
   {
     "custom_capabilities": {
       "name": "special_function",
       "parameters": {},
       "returns": {}
     }
   }
   ```

2. **ç‰ˆæœ¬å…¼å®¹**
   - åè®®ç‰ˆæœ¬æ§åˆ¶
   - å‘åå…¼å®¹ç­–ç•¥
   - å‡çº§æœºåˆ¶

è¿™æ ·çš„æ ‡å‡†åŒ–æ¶æ„èƒ½å¤Ÿï¼š
1. ç»Ÿä¸€æ§åˆ¶æ¥å£ï¼Œé™ä½å­¦ä¹ æˆæœ¬
2. æ”¯æŒæ¨¡æ‹Ÿå’ŒçœŸå®è®¾å¤‡æ— ç¼åˆ‡æ¢
3. å®ç°å³æ’å³ç”¨çš„è®¾å¤‡ç®¡ç†
4. ç®€åŒ–è¿ç»´å’Œè°ƒè¯•æµç¨‹
5. ä¿æŒè¶³å¤Ÿçš„æ‰©å±•æ€§

æ‚¨è§‰å¾—è¿™ä¸ªæ€è·¯å¦‚ä½•ï¼Ÿæˆ‘ä»¬å¯ä»¥å…ˆå®ç°ä¸€ä¸ªå®Œæ•´çš„æ ‡å‡†åŒ–ç¤ºä¾‹ï¼Œç„¶åé€æ­¥æ¨å¹¿åˆ°å…¶ä»–è®¾å¤‡ç±»å‹ã€‚
